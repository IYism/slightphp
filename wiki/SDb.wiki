#labels Featured,database
#SDb 数据库插件

= 主要特性 =

 * 支持多种数据底层驱动，如mysql,mysqli,pdo系列
 * 支持读写，主从分离
 * 支持ORM，与外键查询与更新
 * 简单高效，耦合性低，可以很方便移植


= 1.数据库连接与初始化 =
{{{
$db = new SDb();
$db->init(
  array("host"=>"localhost","user"=>"root","password"=>"","charset"=>"utf8","engine"=>"mysql")
);
}}}
 * charset 就是字符集，可以是utf8,gbk,gb2312等数据库支持的字符集
 * engine  是数据库驱动引擎，有这么多（ "mysql","mysqli","pdo_mysql","pdo_sqlite","pdo_cubrid","pdo_dblib","pdo_firebird","pdo_ibm","pdo_informix","pdo_sqlsrv","pdo_oci","pdo_odbc","pdo_pgsql","pdo_4d"），默认是用的"mysql"


= 2.数据查询 =
数据查询主要提供2种：
 * 1.是select，这是查询多条
{{{
DbObject select($table,$condition="",$item="",$groupby="",$orderby="",$leftjoin="");
}}}
参数：
    # $table 可以是array|string|object，如:
{{{
//字符串
$table="user";
$table="user as a,profile as b";
//数组
$table=array("user","user_profile");
//对像
$table=new stdclass;
$table->t1="user";
$table->ts="profile";
}}}
    # $conditon 检索条件，可以为3种格式：
{{{
//字符串
$condition="user_id=32";
//数组
$condition=array("user_id=32");
$condition=array("user_id>32","user_id<30");
$condition=array("user_id"=>32);
//对像
$condition=new stdclass;
$condition->user_id=32;
}}}
    # $item是要取回的字段名，默认是所有，可以为如下格式：
{{{
//字符串
$item="*";
$item="userid,username";
//数组
$item=array("*");
$item=array("userid","username");
$item=array("user.id","profile.profileid");
//对像
$item=new stdclass;
$item->item1 = "userid";
$item->item2 = "username";
}}}
    # $groupby 是要GROUP的要求，可以为如下格式:
{{{
//字符串
$groupby = "group by userid ";
$groupby = "group by userid,username";
}}}
    $ orderby 是要排序的字段，可以为如下格式:
{{{
//字符串
$orderby = "order by userid desc";
//数组
$orderby = array("userid"=>"desc","user_register_time"=>"asc");
//对像
$orderby = new stdclass;
$orderby->userid="desc";
$orderby->user_register_time="asc";
}}}
    $ leftjoin 是要LEFT JOIN的字段，可以为如下格式:
{{{
//数组
$orderby = array("key"=>"v","key2"=>"v2");
//对像
$leftjoin = new stdclass;
$leftjoin->key="v";
$leftjoin->key2="v2";
}}}
 * 2.是selectOne,这是查询一条
array selectOne($table,$condition="",$item="",$groupby="",$orderby="",$leftjoin="");

 * 3.实例
{{{
//取一个用户记录
$user = $db->selectOne("user",array("user_id"=>1));
//取10个
$db->setLimit(10);
//取第2页
$db->setPage(2);
//算出总数
$db->setCount(true);
$users= $db->select("user",array("userid>30");
}}}

= 数据更新 = 
 * update方法
{{{
boolean|int update($table,$condition="",$item="");
}}}
  # $table 与上面参数形式一样
  # $condition 修改的条件，和上面的一样
  # $item 要修改的字段，和上面的定义一样
 * 实例
{{{
//把用户ID为1的用户，更新nickname为xxxx
$db->update("user",array("id"=>1),array("nickname"=>"xxxx"));
//多表联合更新
$db->update(array("user","profile") , array("user.id"=>1,"user.id=profile.userid"),array("profile.comment"=>"我的注释"));
}}}

= 数据插入 =
 * insert 方法
{{{
int insert($table,$item="",$isreplace=false,$isdelayed=false,$update=array());
}}}
   # $table，要插入的表，和上面的定义一样
   # $item,要插入的字段，和上面的定义一样
   # $isreplace,碰到重复字段，是否用替换模式，用replace代替insert
   # $isdelayed，是否延迟插入
   # $update 和$item的格式一样，碰到重复时要更新字

 * 实例
{{{
//增加一个用户
$db->insert("user",array("username"=>"lili","password"=>"pjf(@EF"));
//增加一个用户，当重复时，更新其密码
$db->insert("user",array("username"=>"lili","password"=>"pjf(@EF"),true);
//增加一个用户，当重重复时，更新操作时间
$db->insert("user",array("username"=>"lili","password"=>"pjf(@EF"),false,false,array("logintime"=>time());
}}}


= 删除 =
{{{
boolean delete($table,$condition="");
}}}

= 执行原始SQL = 
{{{
int|boolean execute($sql);
}}}

= 其它技巧=
 * 分页
{{{
setLimit($limit);
setPage($page);
setCount($count)
}}}

 * 调试与SQL显示
{{{
//只要在代码执行前加上
define("DEBUG",true);
}}}
 * 其它
{{{
setOrderby($orderby);
setGroupby($groupby);
}}}


= [ORM ORM 操作技巧]=

= [ORM ORM 外键操作]=